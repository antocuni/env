#!/bin/bash

case $1 in
    rai1)    FREQ=201.438 ;;
    rai2)    FREQ=567.438 ;;
    rai3)    FREQ=583.375 ;;
    rete4)   FREQ=719.562 ;;
    canale5) FREQ=775.250 ;;
    italia1) FREQ=783.625 ;;
    la7)     FREQ=687.562 ;;
    sky)     FREQ=823.250 ;;
    *) echo "Invalid channel name"; exit;;
esac

case $2 in
    --audio) 
        VENC=""
        AB="ab=128"
        ;;

    *)  VENC="venc=x264{keyint=80,hurry-up,vt=800000}"
        AB="ab=48"
        ;;
esac;


# to tweak the quality, change vb and fps
#SRC="v4l2:///dev/video0:width=352:height=288:v4l2-tuner-frequency=$FREQ"
SRC="v4l2:///dev/video0:width=320:height=240:v4l2-tuner-frequency=$FREQ"
#SRC="v4l2:///dev/video0:width=176:height=112:v4l2-tuner-frequency=$FREQ"

ENCODE="#transcode{vcodec=H264,vb=200,fps=15,scale=1,acodec=mpga,$AB,channels=2,samplerate=44100,$VENC,deinterlace}"
STREAM="std{access=http,mux=asf,dst=:1234}"

/tmp/vlc-1.0.3/vlc --color $SRC :input-slave=alsa:// --sout "$ENCODE:$STREAM" --ttl 12 -I dummy
