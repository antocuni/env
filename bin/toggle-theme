#!/bin/bash

# USEFUL kitty shortcuts:
#   C-S-F5    reload the config
#
#   F1        create marker
#   F2        remove marker
#
#   C-S-PgUp  show_last_command_output
#   C-S-g     show_last_command_output
#   C-S-A     copy last output to clipboard
#   C-S-h     show_scrollback
#
#   C-S-z     scroll to previous prompt
#   C-S-x     scroll to next prompt

CONFIG="$HOME/.config/kitty"

touch /tmp/theme
current=$(cat /tmp/theme)

function reload_kitty_config() {
    killall  -SIGUSR1 kitty
}

function switch_to_dark() {
    echo "$current ==> dark"
    #kitty +kitten themes --reload-in=all Default
    cp $CONFIG/themes/default.conf $CONFIG/current-theme.conf
    reload_kitty_config
    rm -f /tmp/gitconfig_colordiff
    emacsclient -e "(my-theme-dark)"
    echo dark > /tmp/theme
}

function switch_to_light() {
    echo "$current ==> light"
    #kitty +kitten themes --reload-in=all Alabaster
    cp $CONFIG/themes/alabaster.conf $CONFIG/current-theme.conf
    cat >> $CONFIG/current-theme.conf <<EOF

font_size 18.0
EOF
    reload_kitty_config

    cat > /tmp/gitconfig_colordiff <<EOF
# this file has been generated by ~/bin/toggle-theme
[color "diff"]
  meta = "#000000" bold
  frag = red bold
  old = "#000000" "#dddddd" # black over gray
  new = "#000000" "#bbffbb" # black over pastel green
EOF
    emacsclient -e "(my-theme-light)"
    echo light > /tmp/theme
}

case "$current" in
    dark)  switch_to_light;;
    light) switch_to_dark;;
    *)     switch_to_dark;;
esac
