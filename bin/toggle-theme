#!/bin/bash

touch /tmp/theme
current=$(cat /tmp/theme)

CONFIG="$HOME/.config/kitty"

function reload_kitty_config() {
    killall  -SIGUSR1 kitty
}

function switch_to_dark() {
    echo "$current ==> dark"
    #kitty +kitten themes --reload-in=all Default
    cp $CONFIG/themes/default.conf $CONFIG/current-theme.conf
    reload_kitty_config
    rm -f /tmp/gitconfig_colordiff
    echo dark > /tmp/theme
}

function switch_to_light() {
    echo "$current ==> light"
    #kitty +kitten themes --reload-in=all Alabaster
    cp $CONFIG/themes/alabaster.conf $CONFIG/current-theme.conf
    reload_kitty_config

    cat > /tmp/gitconfig_colordiff <<EOF
# this file has been generated by ~/bin/toggle-theme
[color "diff"]
  meta = "#000000" bold
  frag = red bold
  old = "#000000" "#dddddd" # black over gray
  new = "#000000" "#bbffbb" # black over pastel green
EOF
    echo light > /tmp/theme
}

case "$current" in
    dark)  switch_to_light;;
    light) switch_to_dark;;
    *)     switch_to_dark;;
esac
