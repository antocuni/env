#!/usr/bin/env python
# -*- mode: python -*-

import sys
import time
import subprocess

text = sys.stdin.read()
subprocess.Popen(["e"] + sys.argv).wait()
for i in range(10):
    cmd = 'emacsclient -e "(insert \"%s\")" &>/dev/null' % text
    args = ['emacsclient', '-e', '(insert "%s")' % text]
    proc = subprocess.Popen(args, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    retval = proc.wait()
    if retval == 0:
        break
    time.sleep(0.1)
