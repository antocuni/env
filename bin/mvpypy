#!/bin/bash

REV=`$1 -S -c 'from sys import _mercurial as m; print m[2]'`
BRANCH=`$1 -S -c 'from sys import _mercurial as m; print m[1]'`
DIR=`dirname $1`
NUM=`hg --cwd $DIR log -r $REV --template {rev}`

DEST=$DIR/pypy-c-$NUM-$REV-$BRANCH

mv -i "$1" "$DEST"

if [ `basename $1` = pypy-c ]
then
    ln -s "$DEST" "$1"
fi
