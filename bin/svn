#!/bin/bash

function get_terminal_width()
{
    python -c "
import sys, rxvtlib
width, height = rxvtlib.get_terminal_size()
sys.exit(width)"

}

case $1 in
    diff)     
        if isatty
        then
            /usr/bin/svn "$@" | diffpipe.py | less 
        else
            /usr/bin/svn "$@"
        fi ;;

    log)
        if detect_rxvt.py
        then
            shift 1;
            ~/pypy/user/arigo/hack/rxvt-metadata/python/svnlog.py "$@" | less -r
        else
            /usr/bin/svn "$@"
        fi;;

    blame|praise|annotate|ann)
        if detect_rxvt.py
        then
            shift 1;
            get_terminal_width
            WIDTH=$?
            /usr/bin/svn blame "$@" | cut -b -$WIDTH | blamepipe.py "$@" | less -r
        else
            /usr/bin/svn "$@"
        fi;;

    show)
        shift 1;
        if isatty
        then
            svnshow.py "$@" | less
        else
            svnshow.py "$@"
        fi;;
            
    
    f|viewwc) shift 1; viewwc.py "$@" ;;

    *) /usr/bin/svn "$@" ;;
esac
